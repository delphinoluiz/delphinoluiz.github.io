<!DOCTYPE html>
<html>
    <head>
        <title> simple ar.js </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/86/three.min.js"></script>        
        <script src="https://jeromeetienne.github.io/AR.js/three.js/build/ar.min.js"></script>

        <style>
                /* .demo-wrapper {
                  display: inline-block;
                } */
            
                .progress-bar {
                  width: 100%;
                }
            
                [data-role="play-stop"].stopped:after {
                  content: '>';
                }
            
                [data-role="play-stop"].play:after {
                  content: '||';
                }
            
        </style>

    </head>
    <body>

        <div id="container"></div>
        
        <!-- <div id="demo-wrapper"></div> -->
        <script src="simple-video-player.js"></script>
        <script>
            var renderer,
                scene,
                camera,
                container;

            var arSource,
                arContext,
                arMarker = [];

            var videoplayer,
                mesh;

            init();

            function init(){

                container = document.getElementById('container');
  
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                scene = new THREE.Scene();
                camera = new THREE.Camera();

                renderer.setClearColor(0x000000, 0);
                renderer.setSize(window.innerWidth, window.innerHeight);

                container.appendChild(renderer.domElement);

                scene.add(camera);
                scene.visible = false;


                // videoplayer = new SimpleVideoPlayer({
                //     el: document.querySelector('.container'),
                //     url: 'https://s3-eu-west-1.amazonaws.com/onrewind-test-bucket/big_buck_bunny.mp4'
                //     // url: 'https://edgeset.sharepoint.com/:v:/g/EckEqWnJa0xEvmAn8vcbMv8BQOdAKB15pCE1zJNbGZ9lTA?e=5cK475'
                // });

                mesh = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshBasicMaterial({
                    color: 0xFF00FF,
                    transparent: true,
                    opacity: 0.5
                }));

                scene.add(mesh);
                // scene.add(videoplayer);

                arSource = new THREEx.ArToolkitSource({
                    sourceType : 'webcam',
                });

                arContext = new THREEx.ArToolkitContext({
                    cameraParametersUrl: './assets/data/camera_para.dat',
                    detectionMode: 'mono',
                });

                arMarker[0] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/patt.hiro',
                    changeMatrixMode: 'cameraTransformMatrix'
                });

                arMarker[1] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/u4bi.patt',
                    changeMatrixMode: 'cameraTransformMatrix'
                });

                arMarker[2] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/ar.patt',
                    changeMatrixMode: 'cameraTransformMatrix'
                });

                arMarker[3] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/one.patt',
                    changeMatrixMode: 'cameraTransformMatrix'
                });

                arMarker[4] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/two.patt',
                    changeMatrixMode: 'cameraTransformMatrix'
                });

                arMarker[5] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/three.patt',
                    changeMatrixMode: 'cameraTransformMatrix'
                });

                arMarker[6] = new THREEx.ArMarkerControls(arContext, camera, {
                    type : 'pattern',
                    patternUrl : './assets/data/daytona.patt',
                    changeMatrixMode: 'cameraTransformMatrix'
                });



                /* handle */
                arSource.init(function(){
                    arSource.onResize();
                    arSource.copySizeTo(renderer.domElement);

                    if(arContext.arController !== null) arSource.copySizeTo(arContext.arController.canvas);

                });

                arContext.init(function onCompleted(){
                    
                    camera.projectionMatrix.copy(arContext.getProjectionMatrix());

                });


                render();   
                
            }   

            function render(){
                requestAnimationFrame(render);
                renderer.render(scene,camera);                

                if(arSource.ready === false) return;

                arContext.update(arSource.domElement);
                scene.visible = camera.visible;
                // videoplayer.visible = camera.visible;

                mesh.rotateX(.1);

            }          

        </script>
        
    </body>
</html>